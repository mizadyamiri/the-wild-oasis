import{u as q,_ as j,s as g,j as e,B as w,f as K,S as z,H as N}from"./index-438dd456.js";import{u as Z}from"./index.esm-f9283d01.js";import{c as V,d as _,u as $}from"./useCabins-65256454.js";import{u as F}from"./useMutation-5e0b73ac.js";import{F as b}from"./FormRow-f69adc6e.js";import{F as X,I as C}from"./Form-b2b8dfd7.js";import{F as G}from"./FileInput-72be628f.js";import{M as m,C as J,E as U}from"./Empty-64d46a19.js";import{T as v,M as x,a as Y,S as M}from"./TableOperations-3554370d.js";import{l as I,x as ee,y as ie,u as se}from"./helpers-166c3b16.js";import{F as re}from"./Filter-209312df.js";import{R}from"./Row-b6073b20.js";import"./iconBase-26a71e31.js";function A(){const r=q(),{mutate:s,isLoading:c}=F({mutationFn:V,onSuccess:()=>{j.success("new cabin successfully created."),r.invalidateQueries({queryKey:["cabins"]})},onError:n=>{j.error(n.message)}});return{isCreating:c,createCabin:s}}const ae=g.textarea`
  padding: 0.8rem 1.2rem;
  border: 1px solid var(--color-grey-300);
  border-radius: 5px;
  background-color: var(--color-grey-0);
  box-shadow: var(--shadow-sm);
  width: 100%;
  height: 8rem;
`;function ne(){const r=q(),{mutate:s,isLoading:c}=F({mutationFn:({newCabinData:n,id:o})=>V(n,o),onSuccess:()=>{j.success("Cabin successfull edited"),r.invalidateQueries({queryKey:["cabins"]})},onError:n=>{j.error(n.massage)}});return{editCabin:s,isEditing:c}}function H({cabinToEdit:r={},onCloseModal:s}){var E,D,P,k,B;const{createCabin:c,isCreating:n}=A(),{editCabin:o,isEditing:p}=ne(),t=n||p,{id:d,...f}=r,l=!!d,{register:i,handleSubmit:h,reset:y,getValues:S,formState:W}=Z({defaultValues:l?f:{}}),{errors:a}=W;function L(u){const T=typeof u.image=="string"?u.image:u.image[0];l?o({newCabinData:{...u,image:T},id:d},{onSuccess:Q=>{y(),s==null||s()}}):c({...u,image:T},{onSuccess:Q=>y()})}function O(u){}return e.jsxs(X,{onSubmit:h(L,O),type:s?"modal":"regular",children:[e.jsx(b,{label:"Cabin name",error:(E=a==null?void 0:a.name)==null?void 0:E.message,children:e.jsx(C,{type:"text",id:"name",disabled:t,...i("name",{required:"this field is required"})})}),e.jsx(b,{label:"Maximum capacity",error:(D=a==null?void 0:a.maxCapacity)==null?void 0:D.message,children:e.jsx(C,{type:"number",id:"maxCapacity",disabled:t,...i("maxCapacity",{required:"this field is required",min:{value:1,message:"Capasity should atleast be 1"}})})}),e.jsx(b,{label:"Regular price",error:(P=a==null?void 0:a.regularPrice)==null?void 0:P.message,children:e.jsx(C,{type:"number",id:"regularPrice",disabled:t,...i("regularPrice",{required:"this field is required",min:{value:1,message:"Capasity should atleast be 1"}})})}),e.jsx(b,{label:"Discount",error:(k=a==null?void 0:a.discount)==null?void 0:k.message,children:e.jsx(C,{type:"number",id:"discount",disabled:t,defaultValue:0,...i("discount",{required:"this field is required",validate:u=>+u<=+S().regularPrice||"Discount should be less than regular price"})})}),e.jsx(b,{label:"Description",error:(B=a==null?void 0:a.description)==null?void 0:B.message,children:e.jsx(ae,{type:"number",id:"description",disabled:t,defaultValue:"",...i("description",{required:"this field is required"})})}),e.jsx(b,{label:"Image",children:e.jsx(G,{id:"image",accept:"image/*",...i("image",{required:l?!1:"this field is required"})})}),e.jsxs(b,{children:[e.jsx(w,{variation:"secondary",type:"reset",onClick:()=>s==null?void 0:s(),children:"Cancel"}),e.jsx(w,{disabled:t,children:l?"Edit cabin":"Create new cabin"})]})]})}function te(){return e.jsx("div",{children:e.jsxs(m,{children:[e.jsx(m.Open,{opens:"cabin-form",children:e.jsx(w,{children:"Add new cabin"})}),e.jsx(m.Window,{name:"cabin-form",children:e.jsx(H,{})})]})})}function ce(){const r=q(),{isLoading:s,mutate:c}=F({mutationFn:_,onSuccess:()=>{j.success("cabin successfully deleted"),r.invalidateQueries({queryKey:["cabins"]})},onError:n=>j.error(n.message)});return{isDeleting:s,deleteCabin:c}}const oe=g.img`
  display: block;
  width: 6.4rem;
  aspect-ratio: 3 / 2;
  object-fit: cover;
  object-position: center;
  transform: scale(1.5) translateX(-7px);
`,le=g.div`
  font-size: 1.6rem;
  font-weight: 600;
  color: var(--color-grey-600);
  font-family: "Sono";
`,de=g.div`
  font-family: "Sono";
  font-weight: 600;
`,ue=g.div`
  font-family: "Sono";
  font-weight: 500;
  color: var(--color-green-700);
`;function me({cabin:r}){const{deleteCabin:s,isDeleting:c}=ce(),{createCabin:n,isCreating:o}=A(),p=c||o,{id:t,name:d,maxCapacity:f,regularPrice:l,discount:i,image:h,description:y}=r,S=()=>{n({name:`Copy of ${d}`,maxCapacity:f,regularPrice:l,discount:i,image:h,description:y})};return e.jsxs(v.Row,{children:[e.jsx(oe,{src:h}),e.jsx(le,{children:d}),e.jsxs("div",{children:["Fits up to ",f," guestes"]}),e.jsx(de,{children:I(l)}),i?e.jsx(ue,{children:I(i)}):e.jsx("span",{children:"â€”"}),e.jsx("div",{children:e.jsx(m,{children:e.jsxs(x.Menu,{children:[e.jsx(x.Toggle,{id:t}),e.jsxs(x.List,{id:t,children:[e.jsx(x.Button,{icon:e.jsx(ee,{}),onClick:S,children:"Duplicate"}),e.jsx(m.Open,{opens:"edit",children:e.jsx(x.Button,{icon:e.jsx(ie,{}),children:"Edit"})}),e.jsx(m.Open,{opens:"delete",children:e.jsx(x.Button,{icon:e.jsx(se,{}),children:"Delete"})})]}),e.jsx(m.Window,{name:"edit",children:e.jsx(H,{cabinToEdit:r})}),e.jsx(m.Window,{name:"delete",children:e.jsx(J,{resourceName:d,onConfirm:()=>s(t),disabled:p})})]})})})]})}function be(){const{cabins:r,isLoading:s}=$(),[c]=K();if(s)return e.jsx(z,{});if(!r.length)return e.jsx(U,{resource:"cabins"});const n=c.get("discount")||"all";let o;switch(n){case"all":o=r.filter(()=>!0);break;case"no-discount":o=r.filter(i=>i.discount===0);break;case"with-discount":o=r.filter(i=>i.discount>0);break}const p=c.get("sortBy")||"startDate-asc",[t,d]=p.split("-"),f=d==="asc"?1:-1,l=o.sort((i,h)=>(i[t]-h[t])*f);return e.jsx(x,{children:e.jsxs(v,{columns:"0.6fr 1.8fr 2.2fr 1fr 1fr 1fr",children:[e.jsxs(v.Header,{children:[e.jsx("div",{}),e.jsx("div",{children:"Cabin"}),e.jsx("div",{children:"Capacity"}),e.jsx("div",{children:"Price"}),e.jsx("div",{children:"Discount"}),e.jsx("div",{})]}),e.jsx(v.Body,{data:l,render:i=>e.jsx(me,{cabin:i},i.id)})]})})}function xe(){return e.jsxs(Y,{children:[e.jsx(re,{filterField:"discount",options:[{value:"all",lable:"All"},{value:"no-discount",lable:"No discount"},{value:"with-discount",lable:"With discount"}]}),e.jsx(M,{options:[{value:"name-asc",lable:"Sort by name (A-Z)"},{value:"name-desc",lable:"Sort by name (Z-A)"},{value:"regularPrice-asc",lable:"Sort by price (low first)"},{value:"regularPrice-desc",lable:"Sort by price (high first)"},{value:"maxCapacity-asc",lable:"Sort by capacity (low first)"},{value:"maxCapacity-desc",lable:"Sort by capacity (high first)"}]})]})}function De(){return e.jsxs(e.Fragment,{children:[e.jsxs(R,{type:"horizontal",children:[e.jsx(N,{as:"h1",children:"All cabins"}),e.jsx(xe,{})]}),e.jsxs(R,{children:[e.jsx(be,{}),e.jsx(te,{})]})]})}export{De as default};
